CREATE TYPE  name as Object
(firstname varchar2(100),
lastname varchar2(100));

CREATE TYPE address as Object
(street varchar2(100),
city varchar2(100),
zip_code varchar2(100));

CREATE TYPE phone_list AS
TABLE OF NUMBER

CREATE TABLE users(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
name NAME not null,
email varchar2(100) not null UNIQUE,
password varchar2(255) not null,
address ADDRESS,
phone_numbers PHONE_LIST,
created_at TIMESTAMP,
updated_at TIMESTAMP,
PRIMARY KEY(id))
NESTED TABLE phone_numbers STORE AS phone_nested;

CREATE TABLE products(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
name varchar2(100) not null,
description varchar2(255),
brand varchar2(255),
price NUMBER(8,2) not null,
stock NUMBER(38) not null,
created_at TIMESTAMP,
updated_at TIMESTAMP,
PRIMARY KEY (id));

ALTER TABLE products
ADD CONSTRAINT check_positive_price CHECK(price > 0);

CREATE TABLE options(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
name varchar2(100) not null,
product_id NUMBER not null,
PRIMARY KEY(id),
FOREIGN KEY(product_id) REFERENCES products(id)
ON DELETE CASCADE);


CREATE TABLE option_values(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
option_id NUMBER not null,
name varchar2(100) not null,
PRIMARY KEY(id),
FOREIGN KEY(option_id) REFERENCES options(id)
ON DELETE CASCADE);

CREATE TABLE variants(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
product_id NUMBER,
description varchar2(255),
price NUMBER (8,2),
stock NUMBER,
stock_threshold NUMBER,
media_id varchar2(255),
PRIMARY KEY(id),
FOREIGN KEY(product_id) REFERENCES products(id) ON DELETE CASCADE)

CREATE TABLE option_value_variant(
id NUMBER GENERATED BY DEFAULT AS IDENTITY,
option_value_id NUMBER,
variant_id NUMBER,
PRIMARY KEY(id),
FOREIGN KEY (option_value_id) REFERENCES option_values(id),
FOREIGN KEY (variant_id) REFERENCES variants(id) ON DELETE CASCADE);
